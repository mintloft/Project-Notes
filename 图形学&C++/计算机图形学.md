## 】

## Games101

#### 线性代数介绍![](F:\计算机图形学\fig\1.png)

<img src="F:\计算机图形学\fig\2.jpg" style="zoom:33%;" />

若a与b是单位向量，则cos值是两个单位向量a与b的点乘，单位向量模乘为1。

<img src="F:\计算机图形学\fig\3.jpg" style="zoom:33%;" />

<img src="F:\计算机图形学\fig\4.jpg" style="zoom:33%;" />

<img src="F:\计算机图形学\fig\5.jpg" style="zoom:33%;" />

<img src="F:\计算机图形学\fig\6.jpg" style="zoom:33%;" />

<img src="F:\计算机图形学\fig\7.jpg" style="zoom:33%;" />

<img src="F:\计算机图形学\fig\10.jpg" alt="  " style="zoom:33%;" />

<img src="F:\计算机图形学\fig\13.png" style="zoom: 67%;" />

1.a与b向量的叉积得到的结果的正负可以判断a向量在b向量的左侧还是右侧

2.向量的叉积可以判断p在三角形的左内部还是外部，如果AP向量与AB向量，BP向量与BC向量的叉积符号相同（在同一侧），但CP与CA叉积符号与前两个不同，则证明P在三角形外部

##### p向量可以用单位向量分解成在三个坐标轴上之和：。

u，v，w是三个互相垂直的单位向量，关于p的表示就是p向量与三个单位向量做点积得到的投影相加

<img src="F:\计算机图形学\fig\14.png" style="zoom: 33%;" />

向量的叉积也可以写成矩阵与坐标乘积的形式：

<img src="F:\计算机图形学\fig\15.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig\16.png" style="zoom:50%;" />

变换：模型变换 、视图变换

<img src="F:\计算机图形学\fig\17.png" style="zoom: 33%;" />

摄像机拍摄从3D到2D，投影变换。

#### 2D线性变换

（Scale）尺度变换:

<img src="F:\计算机图形学\fig\18.png" style="zoom: 50%;" />

水平变换：<img src="F:\计算机图形学\fig\19.png" style="zoom:50%;" />

旋转矩阵：旋转矩阵，找四个点去试推导

<img src="F:\计算机图形学\fig\20.png" style="zoom: 67%;" />

错切变换：它指的是类似于四边形不稳定性那种性质，方形变平行四边形，任意一边都可以被拉长的过程

<img src="F:\计算机图形学\fig\21.png" style="zoom: 67%;" />

平移变换无法通过简单的矩阵乘法实现，不是线性变换，但是可以用齐次坐标来表示

<img src="F:\计算机图形学\fig\22.png" style="zoom: 50%;" />

![](F:\计算机图形学\fig\24.png)

2D变换的齐次坐标：

![](F:\计算机图形学\fig\25.png)

逆变换：逆变换就是乘上逆矩阵

![](F:\计算机图形学\fig\26.png)

矩阵的变换应是从右到左的顺序：

<img src="F:\计算机图形学\fig\27.png" style="zoom: 50%;" />

旋转变换是基于顶点在原点时变换：先将图像平移至原点T（-c），然后在进行R（a）旋转变换，再平移回pointC

<img src="F:\计算机图形学\fig\29.png" style="zoom: 67%;" />

#### 3D线性变换

3D变换就是用4*4的矩阵用来做仿射变换

![](F:\计算机图形学\fig\30.png)

![](F:\计算机图形学\fig\32.png)

![](F:\计算机图形学\fig\33.png)

因为旋转矩阵是正交矩阵，矩阵的转置等于矩阵的逆

向反方向旋转得矩阵就是矩阵的逆（将西特换成－西特）

![](F:\计算机图形学\fig\34.png)

3D变换中，3D点坐标是（x，y，z，1）T，3D向量是（x，y，z，0）T

![](F:\计算机图形学\fig\35.png)

绕着那个轴旋转，那个轴对应矩阵上的元素就是01向量。

Ry不同是因为将 xyzxyzxyz循环排列（循环对称）可以得出X叉乘Y等于Z，Y叉乘Z等于X，是Z叉乘X等于Y（而不是按xyz的先后顺序：X叉乘Z等于Y）所以矩阵中的旋转矩阵部分是逆矩阵。

<img src="F:\计算机图形学\fig\36.png" style="zoom: 33%;" />

**罗德里格斯旋转公式：对于向量的三维旋转问题，给定旋转轴和旋转角度，用罗德里格斯（Rodrigues）旋转公式可以得出旋转后的向量。另外，罗德里格斯旋转公式可以用旋转矩阵表示，即将三维旋转的轴-角（axis-angle）表示转变为旋转矩阵表示。**

<img src="F:\计算机图形学\fig\37.png" style="zoom: 67%;" />

将三维空间中的任意旋转分解成在x,y,z轴上的旋转的公式，N矩阵代表的是单个向量转化成用于进行叉乘的矩阵

**旋转角度为阿尔法，n为旋转的轴。如果在三维空间中将图形绕任意的点旋转一定的度数，我们可以先将点通过平移移到原点，在原点旋转，再平移回去**

![](F:\计算机图形学\fig\38.png)

**如何绕任意轴旋转：**

我们只有绕x，y, z旋转的方法，怎么随便给一个轴让你绕着他旋转呢！很直观的，先把该轴给先旋转到x或者y或者z轴上，接着就可以应用上面已经得到的标准旋转矩阵，最后要记得把该轴逆旋转回它原先的地方就完成了，用矩阵表示如下：

![[公式]](https://www.zhihu.com/equation?tex=R1RxR1%5ET+%2A+%28x%2Cy%2Cz%29%5ET)

这里的Rx是知道的，也就是3维下绕x轴旋转的矩阵，那么根据之前的分析问题只剩怎么求R1了，设我们想围绕旋转的轴为![[公式]](https://www.zhihu.com/equation?tex=u)，R1便是将u旋转到x的矩阵。 具体来说这里需要以u为一轴，构造一个3维正交坐标系，然后将u-x对齐，那么其它两轴就肯定和y和z对齐了

#### 视图变换与投影变换：

**视图/摄像机变换：**

<img src="F:\计算机图形学\fig\39.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig\40.png" style="zoom:50%;" />

**观测矩阵（相机）初始的定义：相机位置，朝向，相机的向上方向，相机的位置在原点处**

我们人习惯看向z轴方向所以相机朝向-z方向

<img src="F:\计算机图形学\fig\41.png" style="zoom:50%;" />

![](F:\计算机图形学\fig\42.png)

先将摄像机平移至原点，

再旋转g朝向-z方向，

再旋转t到y方向，

在旋转g*t到x方向。

![](F:\计算机图形学\fig\43.png)

**求旋转摄像机（R）矩阵过程：**

视图变换矩阵 即求一个可以将g，t,  g*t三维向量变换到-Z,Y,X坐标轴的矩阵

先求出水平坐标系x（1，0，0），y（0，1，0），z（0，0，1）三个单位向量，旋转到当前摄像机的旋转矩阵，再求逆。

![](F:\计算机图形学\fig\44.png)

**透视投影变换：**

<img src="F:\计算机图形学\fig\45.png" style="zoom: 67%;" />

透视投影更符合人眼看到的近大远小的特点。

正交投影工业上一般使用。

![](F:\计算机图形学\fig\46.png)

![](F:\计算机图形学\fig\47.png)

![](F:\计算机图形学\fig\48.png)

<img src="F:\计算机图形学\fig\51.png" style="zoom: 80%;" />

<img src="F:\计算机图形学\fig\49.png" style="zoom:67%;" />

**这里其实是取摄像机视角正对着z的xyo的剖面，这个视角下远处图像与近距离图像的z是不变的，只有xy发生相似变换。然而在其他视角下，在左右两个面，z也是发生相似变换的。所以不可以在矩阵中写入带有z的变量的矩阵，要用其他确定的常量去代替。**

![](F:\计算机图形学\fig\50.png)



方便计算将分母约掉：

![](F:\计算机图形学\fig\54.png)

根据上图两向量对应关系可列出矩阵。但由于第三行最后两个元素具有不确定性，所以需要求解透视to正交矩阵的第三行最后两个元素：

![](F:\计算机图形学\fig\52.png)

n可以是任何数，所以可以用z代替n，从而列出等式 An+B=n方

![](F:\计算机图形学\fig\56.png)

根据透视变换中心点元素经过变换后坐标不变原则  可列出等式：Af+B=f方

![](F:\计算机图形学\fig\58.png)

![](F:\计算机图形学\fig\59.png)

<img src="F:\计算机图形学\fig\61.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig\62.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig\64.png" style="zoom:50%;" />

#### 光栅化：

<img src="F:\计算机图形学\fig\65.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig\66.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig\67.png" style="zoom: 67%;" />

#### 视口变换：

![](F:\计算机图形学\fig\68.png)

**光栅化**：将多边形打碎成一个个像素，画在屏幕上

早期的一种显示设备：CRT 隔行扫描

LCD：光通过右侧竖直的光栅经过液晶的扭曲之后，可以扭曲呈水平的通过左侧水平的光栅

LED：由不同发光二极管构成的阵列

电子墨水显示屏幕（通过电压控制墨水）刷新率低

<img src="F:\计算机图形学\fig\69.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig\70.png" style="zoom: 50%;" />

**算出定义在屏幕空间的某一函数，在像素中心的值是多少**

<img src="F:\计算机图形学\fig\71.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig\72.png" style="zoom: 50%;" />

**inside函数内部，就是三角形三个点与三角形外部的点构成的边与三角形的三条边分别做叉积，得到的z符号都是相同的就是在三角形内部**

![](F:\计算机图形学\fig\73.png)

![](F:\计算机图形学\fig\74.png)

<img src="F:\计算机图形学\fig\75.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig\76.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig\77.png" style="zoom:50%;" />

#### 抗锯齿处理技术

照片是一种采样，由感光元件平面的光学信息通过离散成图像上的像素是一种采样。（发生在不同位置的采样）

视频是一种采样（发生在不同时间的采样）

<img src="F:\计算机图形学\fig\78.png" style="zoom:50%;" />

**采样问题**

不同时间的采样：

<img src="F:\计算机图形学\fig\78.png" style="zoom:50%;" />

摩尔纹：

<img src="F:\计算机图形学\fig\82.png" style="zoom:50%;" />

锯齿，车轮效应

<img src="F:\计算机图形学\fig\83.png" style="zoom:50%;" />

**反走样**：先进行模糊操作，再进行采样（先进行采样操作，再进行模糊达不到效果）

**频域**：傅里叶级数展开（任何周期函数都可以通过傅里叶级数展开表示，并且可以利用这个性质将许多频率从低到高的函数相加无限去拟合）：

<img src="F:\计算机图形学\fig\84.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig\85.png" style="zoom: 80%;" />

采样时间间隔相同，但是频率变快，导致重建失败

黑点是采样率。

**走样：**使用安全相同的采样率，会发现最后一组**函数采样率**已经跟不上**函数频率**的变化情况

**同样的采样方法采样两种完全不同的函数（蓝色与黑色），得到的结果我们无法区分，叫做走样**

<img src="F:\计算机图形学\fig\87.png" style="zoom:67%;" />

**滤波**：去掉一系列特定的频率

**傅里叶函数**：将图像**时域**变换到**频域**。

**高通滤波**：把低频波段过滤掉，人物与背景的边界变化大频率较高。

<img src="F:\计算机图形学\fig\88.png" style="zoom:50%;" />

**低通滤波相反**：

<img src="F:\计算机图形学\fig\89.png" style="zoom:67%;" />

**右侧图**为**频谱**，显示图像在频率不同部分长什么样，**越靠近中间的地方，越低频**

```
时域上的卷积等于频域上的乘积。我们可以将图像与滤波器都通过傅里叶变换到频域上，在进行乘积操作，再进行逆傅里叶变换等于卷积操作得到的结果
```

“盒子”是一个低通滤波器，越大的盒子 kernel，得到的图像越模糊：

<img src="F:\计算机图形学\fig\90.png" style="zoom:80%;" />

c是进行采样的冲积函数对a函数进行采样 对应到频域上就是右侧 b,d,f（采样就是重复原始信号的频谱）：

<img src="F:\计算机图形学\fig\91.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig\92.png" style="zoom:67%;" />

频谱在经过复制粘贴下发生了混叠

#### 反走样

<img src="F:\计算机图形学\fig\93.png" style="zoom: 33%;" />

如何减少走样？ 1.增加采样率 2.反走样,在采样前首先拿掉高频信息

<img src="F:\计算机图形学\fig\94.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig\95.png" style="zoom:50%;" />

**反走样操作**的基本方法：1.对于每一个像素，将每个三角形覆盖面的平均求出来。2.在进行采样操作

<img src="F:\计算机图形学\fig\96.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig\97.png" style="zoom:50%;" />

#### MSAA

<img src="F:\计算机图形学\fig\98.png" style="zoom:67%;" />

用更多的采样点进行反走样，反走样的近似

<img src="F:\计算机图形学\fig\99.png" style="zoom:50%;" />

每个像素均匀取N*N个采样点。

<img src="F:\计算机图形学\fig\100.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig\101.png" style="zoom:80%;" />

<img src="F:\计算机图形学\fig\102.png" style="zoom:50%;" />

FXAA：相当于对于已经采样完的图像的边缘用图像匹配方法找到，并将边缘换成没有锯齿的边缘。

 TAA：相当于对于上一帧的每个像素的值在这一帧还会发挥作用复用进来。

DLSS：将一张小图拉大又不想看到中间的锯齿，超分辨率过程与抗锯齿过程十分相似，用深度学习方法去”猜“出中间的细节缺失

<img src="F:\计算机图形学\fig\103.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig\104.png" style="zoom:50%;" />

应用画家算法，按深度越深越优先画的顺序进行排序（时间nLogn），然后由远及近去解决遮挡问题

<img src="F:\计算机图形学\fig\105.png" style="zoom:67%;" />

特殊情况：三个面互相遮挡，无法利用画家算法进行排序

<img src="F:\计算机图形学\fig\106.png" style="zoom:67%;" />

对于每一个像素，**在生成渲染成的结果图（Frame Buffer）的同时**，生成一个几何物体每个像素**最浅深度的深度缓存（depth-buffer）**

对于深度的测试，我们假设成，深度（永远为正）离摄像机越近的距离越小，越远距离数值越大

<img src="F:\计算机图形学\fig\107.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig\108.png" style="zoom: 67%;" />

对于每一个三角形的每一个像素，如果**该像素的深度小于深度缓存中的深度，则渲染结果图**，与**深度缓存同时进行更新**，否则不更新

<img src="F:\计算机图形学\fig\109.png" style="zoom:80%;" />

<img src="F:\计算机图形学\fig\110.png" style="zoom:80%;" />

深度缓存算法时间复杂度是O（n），其只是**记录了当前图形像素的最小值，大的是舍掉，没有排序**

对于上上图的红色的三角形与蓝色三角形，Z-Buffer记录这两个三角形得到的结果图没有记录的先后顺序的区别

对于MSAA进行深度缓存要对每个采样点进行一次深度缓存

<img src="F:\计算机图形学\fig\111.png" style="zoom:67%;" />

对于不同物体应用不同材质进行着色

<img src="F:\计算机图形学\fig\112.png" style="zoom:50%;" />

#### **布林冯着色模型：**

漫反射项

高光项

环境光项

![](F:\计算机图形学\fig\113.png)

**漫反射项**

![](F:\计算机图形学\fig\114.png)

<img src="F:\计算机图形学\fig\115.png" style="zoom: 67%;" />

**下图：漫反射项中带l与n向量点乘的原因，点乘得到的余弦值越大，证明照射到物体表面的光束越多。**

<img src="F:\计算机图形学\fig\116.png" style="zoom: 80%;" />

**下图：点光源的强度与物体上的点到点光源的距离的平方成反比:**

<img src="F:\计算机图形学\fig\117.png" style="zoom:50%;" />

漫反射项与光线v的方向没有任何关系。

<img src="F:\计算机图形学\fig\118.png" style="zoom:80%;" />

**高光项**

<img src="F:\计算机图形学\fig\119.png" style="zoom: 67%;" />

Ks是高光系数，默认是代表的白光

h为半程向量，等于v与l的单位向量相加之和，v是人眼观测的方向，在人眼观测方向与反射方向接近时，Ls高光项越v

大，所以在半程向量（v与l的角平分线）与法线接近时，高光项越大

<img src="F:\计算机图形学\fig\120.png" style="zoom:80%;" />

在（0，n点乘h）上加上p，令cos这个函数变得更陡，变化更明显，否则余弦函数的容忍度太高了

<img src="F:\计算机图形学\fig\121.png" style="zoom:80%;" />

布林冯模型，高光项的指数p，p越大，证明在图形中可视的角度下高光的部分越小

Ks越大，高光的部分也越大

**环境光项**

保证整个物体没有一个部分是黑的，给予整个物体相同的光强度乘上一个环境光系数

<img src="F:\计算机图形学\fig\122.png" style="zoom: 67%;" />

**布林冯着色模型：**

<img src="F:\计算机图形学\fig\123.png" style="zoom:67%;" />

#### **着色频率：**

##### 1.Flat shading

<img src="F:\计算机图形学\fig\124.png" style="zoom: 50%;" />

##### 2.Gouraud shading

<img src="F:\计算机图形学\fig\125.png" style="zoom:67%;" />



##### 3.冯shading

<img src="F:\计算机图形学\fig\126.png" style="zoom:67%;" />

冯 shading是一种着色频率，不是布林冯着色模型.

着色的效果不一定说逐像素的效果一定就越好，如果物体表面很复杂，本身就有许多个面，flat shading效果不一定就差。

<img src="F:\计算机图形学\fig\127.png" style="zoom:50%;" />

三角形顶点的法线，与相邻的面的法线做平均.

<img src="F:\计算机图形学\fig\128.png" style="zoom: 33%;" />

#### **实时渲染管线：**

1.输入三维空间中的点，

2.把三维空间中的点投影到屏幕上，

3.点形成三角形，

4.通过光栅化将fragment离散到屏幕上、采样、深度测试，

4.着色

5.许多个fragment对应一个像素，维护每一个fragment拼成一个三角形的黑边

<img src="F:\计算机图形学\fig2\1.jpg" style="zoom: 33%;" />

##### MVP变换：

对每一个顶点进行MVP变换.

<img src="F:\计算机图形学\fig2\2.png" style="zoom: 67%;" />

##### 光栅化：

<img src="F:\计算机图形学\fig2\3.png" style="zoom:67%;" />

##### 深度缓存：

<img src="F:\计算机图形学\fig2\4.png" style="zoom: 67%;" />

##### 着色：

<img src="F:\计算机图形学\fig2\6.png" style="zoom:67%;" />

##### 纹理映射：

<img src="F:\计算机图形学\fig2\7.png" style="zoom:67%;" />

**opengl的shader：**

1.fragment/pixel shader 

2.顶点shader

![](F:\计算机图形学\fig2\8.png)

#### **纹理映射**

<img src="F:\计算机图形学\fig2\9.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\10.png" style="zoom: 50%;" />

将三维空间的坐标映射到纹理（定义了一个u，v得坐标轴）上，u,v

u,v两个方向范围在0-1

<img src="F:\计算机图形学\fig2\11.png" style="zoom: 33%;" />

不同的位置可以映射相同的纹理，重复多次：

<img src="F:\计算机图形学\fig2\12.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig2\13.png" style="zoom: 67%;" />

纹理定义着色时各个不同点的属性，用纹理方式改变逐点的属性

#### **重心坐标：**

插值可以对三角形顶点，顶点之间的任意点的任意属性(u,v颜色)进行插值

在三角形内部先插值法线

怎么做插值：重心坐标

三角形内任意点坐标都可以用重心坐标公式表示

<img src="F:\计算机图形学\fig2\14.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig2\15.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\16.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig2\17.png" style="zoom:50%;" />

重心坐标做插值**必须要在投影之前的三维空间中的三角形做插值**，而不是在投影之后在做插值.

<img src="F:\计算机图形学\fig2\18.png" style="zoom:67%;" />

#### **在实际渲染中应用纹理：**

使用texcolor去代替Kd.

<img src="F:\计算机图形学\fig2\19.png" style="zoom:67%;" />

左图纹理过小，需要纹理放大，许多像素处于同一纹理值。一般用于图片放大后，使用双线性插值，计算出新的灰度，用于空缺像素的填充.

<img src="F:\计算机图形学\fig2\20.png" style="zoom: 67%;" />

应用了两次水平方向的线性插值，一次竖直方向上的线性插值.   通过四个点的插值，得到一个平滑的过渡

<img src="F:\计算机图形学\fig2\22.png" style="zoom: 67%;" />

纹理大了（多了）会引起的问题：

远处摩尔纹，近处锯齿。走样明显

<img src="F:\计算机图形学\fig2\23.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig2\24.png"  />

<img src="F:\计算机图形学\fig2\25.png" style="zoom: 67%;" />

纹理增大，像素内部覆盖的纹理变化率较大，但采样点不够，造成走样

**解决方法：**

1. 增加采样点
2. 得到这个与区域内的平均值 范围查询：平均

<img src="F:\计算机图形学\fig2\26.png" style="zoom:67%;" />

#### MIPMAP

**在渲染之前  用MipMap将纹理都处理一遍**，每层处理分辨率减少一半，一共logN层.

<img src="F:\计算机图形学\fig2\27.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig2\28.png" style="zoom: 67%;" />

**MipMap**仅仅是额外的**1/3**存储空间。

将光栅化屏幕上的一个中心点，与周围两个点投影到对应的纹理空间（u，v）上，求纹理空间上点与点的距离，并求一个最大值作为L。

<img src="F:\计算机图形学\fig2\104.png"  />

如 右图覆盖区域是4×4个像素，那么我们就查是在哪一层会变为1×1的像素（D=log2L），完了就可以查那个像素得出这个区域的平均值是多少

<img src="F:\计算机图形学\fig2\30.png" style="zoom: 67%;" />

由于图像是连续的，例：如何查询1.8层的像素呢

<img src="F:\计算机图形学\fig2\31.png" style="zoom:67%;" />

三线性插值导致过模糊现象，三线性插值限制：1.近似的正方形区域 2.插值取到的是近似值，不是准确值

<img src="F:\计算机图形学\fig2\32.png" style="zoom:50%;" />

#### **各向异性过滤：**

效果优于三线性插值，水平方向对宽度压缩，竖直方向对长度压缩

<img src="F:\计算机图形学\fig2\33.png" style="zoom:67%;" />

各向异性过滤解决了对应到纹理必须近似成正方形的问题，这样可以近似成长方形。

<img src="F:\计算机图形学\fig2\35.png" style="zoom: 67%;" />

各向异性过滤的空间开销是原来的三倍。

**EWA过滤：**

可以用多个不同圆形去覆盖原先的形状，造成代价是需要多次查询耗时

<img src="F:\计算机图形学\fig2\36.png" style="zoom: 67%;" />



**纹理**可以理解成对一块区域（数组），做点查询或范围查询

犹他茶壶：

我们可以用纹理将四面八方的环境光记录下来，用来渲染

<img src="F:\计算机图形学\fig2\37.png" style="zoom:67%;" />

环境光照与环境贴图 认为只记录光照信息，即无限远没有实际意义

 spherical Map  把环境光记录在球面上，并且展开。

<img src="F:\计算机图形学\fig2\38.png" style="zoom: 33%;" />

会在靠近球面极点时出现扭曲问题.

<img src="F:\计算机图形学\fig2\39.png" style="zoom:50%;" />

我们可以把环境光记录在立方体的六个表面上并且展开.

<img src="F:\计算机图形学\fig2\40.png" style="zoom: 33%;" />

Cube Map 可以通过把环境光映射在立方体表面.

在球中的方向要转换成在立方体中的方向。

纹理除了可以做漫反射项 Kd的颜色系数还可以可以做凹凸贴图

#### 凹凸贴图

物体表面高度发生改变->法线发生改变->着色发生改变，我们通过一个”假的“法线营造一个视觉是凹凸的效果（实际上几何并没有变化）

<img src="F:\计算机图形学\fig2\41.png" style="zoom: 33%;" />

凹凸贴图与法线贴图都是为了改变任何一个点的法线

<img src="F:\计算机图形学\fig2\42.png" style="zoom: 50%;" />

通过凹凸贴图，改变相对高度，改变了法线.

<img src="F:\计算机图形学\fig2\45.png" style="zoom:67%;" />

<img src="F:\计算机图形学\fig2\47.png" style="zoom:50%;" />

要把在局部坐标系下计算出的法线方向变换到世界坐标系

<img src="F:\计算机图形学\fig2\48.png" style="zoom: 50%;" />

#### 位移贴图：

位移贴图与凹凸贴图都是用相同的纹理去定义任意一个点高度的差别，所以他们的输入都是相同的纹理

<img src="F:\计算机图形学\fig2\50.png" style="zoom: 50%;" />

不同点：位移贴图进行的是实际几何上的位移，位移贴图的采样将三角形细分的足够多，做到三角形顶点之间的间隔比纹理变换更快，采样率足够细致。凹凸贴图只是利用相对高度差重新计算法线，不发生真实的几何改变，造成视觉上的差异。 

<img src="F:\计算机图形学\fig2\51.png" style="zoom: 50%;" />

使用预先计算好的shading

<img src="F:\计算机图形学\fig2\52.png" style="zoom: 50%;" />

**3D纹理**

<img src="F:\计算机图形学\fig2\53.png" style="zoom: 50%;" />

#### **几何：**

有许多方式去代表几何形状

<img src="F:\计算机图形学\fig2\54.png" style="zoom: 50%;" />

**隐式几何：**

<img src="F:\计算机图形学\fig2\55.png" style="zoom: 67%;" />

**隐式**：把点带入这个函数式中，如果小于零，代表在内部，大于零在外部.

<img src="F:\计算机图形学\fig2\56.png" style="zoom: 33%;" />



**显式**：在u，v坐标系中的点，通过函数f（x,y,z）得到三维空间中的点组成的形状

<img src="F:\计算机图形学\fig2\57.png" style="zoom: 50%;" />

用显式方法表示，判断坐标点是否在表面上，内，外变难了.

<img src="F:\计算机图形学\fig2\58.png" style="zoom: 50%;" />

**CSG（隐式）**：通过简单几何体的布尔运算定义新的几何

<img src="F:\计算机图形学\fig2\59.png" style="zoom: 33%;" />

**距离函数**：对于空间中任何一个点，都可以定义出来一个值，这个点如果在物体内，这个值就代表点到这个物体表面最小的距离为负数，在物体外为正数同理。

<img src="F:\计算机图形学\fig2\60.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\61.png" style="zoom: 67%;" />

**距离函数** 用于做运动中的两个物体融合。上面三幅图可以代表，两个运动的物体，运动到一起后相互融合，遮蔽。blend（A,B）表现出来的一个纯黑区域，一个中间灰色区域，一个白色区域并不能很好的表现出运动中的物体变化的 一半黑色，一半白色的状态.       对于黑线位置的边界的距离函数，小于0在左，大于0在右的两张图 SDF（A），SDF（B）。再对SDF（A），SDF（B）进行blend得到边界0在位置中间，一般明，一半暗得运动的效果

<img src="F:\计算机图形学\fig2\62.png" style="zoom:50%;" />

图中有正数，负数，通过双线性插值的方法，确定结果为0的点，连起来就是曲线f（x) = 0

<img src="F:\计算机图形学\fig2\63.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\64.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\65.png" style="zoom:50%;" />

**计算机图形中的显式几何表达：**

隐式的表示如果放在图形十分复杂的情况下会不好表述，出现问题，这里就用到了显式表示

<img src="F:\计算机图形学\fig2\67.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\69.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\70.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\71.png" style="zoom:50%;" />

贝塞尔曲线：（显式的几何表示方法）

<img src="F:\计算机图形学\fig2\72.png" style="zoom: 50%;" />

用任意多个控制点，如何画出贝塞尔曲线

<img src="F:\计算机图形学\fig2\73.png" style="zoom: 50%;" />

就先假设b0-b1时间为1，取t时间的b01的点。在b1-b2时间为1，取t时间的点b11.连接b01-b11.取b01-b

就先假设b0-b1时间为1，取t时间的b01的点。在b1-b2时间为1，取t时间的点b11.连接b01-b11,假设b01-b11时间为1,.取b01-b11时间为t的点，即为从b0-b2时间为t的点。。。递归，我们能画出0到1时间内的任意一个点就能画出曲线。

<img src="F:\计算机图形学\fig2\74.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig2\75.png" style="zoom: 33%;" />

不断的对周围两点做线性插值，得到了一个即二项式 （x+t）^n的展开式

把1-t看成是x

**伯恩斯坦多项式**： n代表一共有几阶的插值 ，j代表点的下标（或在两点之间的插值点下标为前一个点的下标）

<img src="F:\计算机图形学\fig2\76.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig2\77.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\78.png" style="zoom: 50%;" />

贝塞尔曲线： 控制点在t=0时，b（0）  =b0 ，b0为起始点。 t=1时，b（1）= b3，b3为终点.

四个控制点 （b0,b1,b2,b3）的曲线：起始点的切线为 3（b1-b0），终点的切线：3（b3-b2）

凸包：能够包围给定几个点围成的几何形体的最小凸多边形

**逐段的贝塞尔曲线**

我们可以定义一个逐段的贝塞尔曲线，（每四个控制点定义一段贝塞尔曲线）

<img src="F:\计算机图形学\fig2\79.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\80.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\81.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\82.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\83.png" style="zoom: 50%;" />

**B样条：**

可以理解成由伯恩斯坦多项式在时间t的不同的几个项对不同的控制点进行加权平均（由这个函数通过不同的方式组合起来叫做基函数）。

通过拖拽某个点可以更改曲线局部的位置，知道这个点局部的范围，具有局部性。

贝塞尔曲线如果改变中间一个点的位置，整条曲线会发生变化不具备这种局部性。

##### 曲面：

<img src="F:\计算机图形学\fig2\84.png" style="zoom: 33%;" />

贝塞尔曲面 16个控制点，贝塞尔曲线是显式表示，由（u，v）参数映射

<img src="F:\计算机图形学\fig2\85.png" style="zoom: 33%;" />

使用（u，v）代表（t1，t2）水平和竖直方向的时间t

<img src="F:\计算机图形学\fig2\86.png" style="zoom: 33%;" />

在16个控制点形成的四条曲线上，取 u，（u属于0-1），在每单条曲线上取一个控制点，四条曲线上按u取四个控制点；再按着v，（v属于0-1），在按u的四个控制点的曲线上取一个控制点，这个点即（u，v）映射到曲面上的点。

曲面上的任何点可由（u，v）在0-1范围内映射过去

贝塞尔曲线是显式表示，由（u，v）参数映射

<img src="F:\计算机图形学\fig2\87.png" style="zoom: 50%;" />

#### **曲面细分：**

**loop细分：**

<img src="F:\计算机图形学\fig2\88.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\89.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\90.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\92.png" style="zoom: 50%;" />

**对于中间形成的老顶点（白点）的更新**： 用（1-n*u）对当前的位置进行加权，用u对周围点的位置进行加权平均

**Catmull-Clark细分：**

以上是Catmull-clark细分，可以对任何四边形细分，但是loop细分只能对三角形细分

<img src="F:\计算机图形学\fig2\93.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig2\94.png" style="zoom: 50%;" />

在细分（每个非四边形面引入奇异点后），非四边形面都会消失。不断细分发生面的变化会越来越光滑

不断细分发生面的变化会越来越光滑

**Catmull-clark细分**：可以对任何四边形细分

**loop细分** ：                 只能对三角形细分

#### **曲面简化：**

<img src="F:\计算机图形学\fig2\95.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\96.png" style="zoom:50%;" />

**二次度量误差：**

去坍缩哪些边，那些边相对“不重要”，可以进行坍缩。不断去优化这个点的位置，使得这个点到其他相邻几个面的平方和（距离）最小。   （二次指的是  平方）

<img src="F:\计算机图形学\fig2\97.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig2\98.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\99.png" style="zoom: 50%;" />

#### shadow mapping

应用shadowing mapping做两趟光栅化，可以通过深度对比的方式得到阴影

<img src="F:\计算机图形学\fig2\100.png" style="zoom: 50%;" />

使用shadow mapping，在生成阴影这一步我们是不需要知道场景的几何信息的

<img src="F:\计算机图形学\fig2\101.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\102.png" style="zoom: 33%;" />

**第一步**，假设光源出有一个摄像机，（类似做光栅化），看向场景，记录看到的点的深度是多少

**第二步**，从真实的相机，看向场景渲染整个场景，投影回光源的虚拟相机所成像的图像上，将实际的深度与之前记录的深度作比较，深度不同则证明这个光源看不到的点在阴影中

#### Shadows Maps的问题

<img src="F:\计算机图形学\fig2\103.png" style="zoom:50%;" />

### 光线追踪

<img src="F:\计算机图形学\fig2\105.png" style="zoom: 50%;" />

光栅化是实时的，光线追踪是离线的.

光线追踪比光栅化质量高，准确，但是相对耗时。

<img src="F:\计算机图形学\fig2\106.png" style="zoom: 33%;" />

**基础光线追踪算法：**

<img src="F:\计算机图形学\fig2\107.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\108.png" style="zoom: 33%;" />

从eye point投射出一道eye ray，经过成像平面的一个像素，投射到场景上最近的点，从这个点向光源连线（shadow ray）并判断有无遮挡.

通过 法线，入射方向，出射方向 就可以判断这一点的着色。

#### Whitted-style 光线追踪

光线会通过折射反射经过很多次弹射，再进行着色，所以提出了Whitted 光线追踪

光线一部分能量进行反射，一部分能量折射。

![](F:\计算机图形学\fig2\109.png)

光源将 primary ray secondary rays shadow rays 三种光线经过的着色点着色的值相加，得到的值赋在着色面上

<img src="F:\计算机图形学\fig2\110.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\111.png" style="zoom: 33%;" />

解出的点一定是正的.

<img src="F:\计算机图形学\fig2\113.png" style="zoom: 33%;" />

光线与封闭的物体上的三角形求交点，若解出的点为奇数个，则在物体内，若解出来的**点为偶数个**在物体外

光线（任意一条射线）与封闭的物体上的三角形求交点，若解出的**点为奇数个**，则在物体内，若解出来的点为偶数个在物体外

<img src="F:\计算机图形学\fig2\115.png" style="zoom:33%;" />

一条光线投射到物体，经过物体内每一个三角形，寻找一个t 最小的为交点，需要加速这个过程。

光线与三角形的交点只能为1个或零个。

一条光线投射到物体，经过物体内每一个三角形，寻找一个t 最小（最近）的为交点。交点数量太多，需要加速这个过程。

光线与三角形的交点只能为1个或零个

<img src="F:\计算机图形学\fig2\116.png" style="zoom: 50%;" />

**光线与三角形求交点：**

1.先判断交点是否在平面内

2.再判断交点是否在三角形内

<img src="F:\计算机图形学\fig2\117.png" style="zoom: 33%;" />

1-b1-b2非负，b1，b2非负.

**加速光线与三角形求交点：**

光线要与物体每每个三角形测试是否相交，且要找到最近的交点，过程非常慢

<img src="F:\计算机图形学\fig2\119.png" style="zoom: 33%;" />

如何加速光线与三角形求交：

使用包围盒。

<img src="F:\计算机图形学\fig2\120.png" style="zoom: 33%;" />

**轴对齐包围盒：**

<img src="F:\计算机图形学\fig2\121.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\122.png" style="zoom: 33%;" />

得到了光**线通过x对面的交点**连成的线段与**光线通过y对面交点**连成的线段.

实际光线与包围盒的交点是**两条线段**的**交集**

<img src="F:\计算机图形学\fig2\123.png" style="zoom: 50%;" />

**如果 t enter < t exit ,意味着光线与包围盒有交点.**

光线进入盒子：光线进入所有的对面

光线离开盒子:   光线离开任意一个对面

<img src="F:\计算机图形学\fig2\124.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\141.png" style="zoom:50%;" />

总结：光线与AABB包围盒相交的前提：1.进入时间小于离开时间  2.离开时间大于0

<img src="F:\计算机图形学\fig2\125.png" style="zoom:50%;" />

光线与包围盒无交点，光线与物体也一定没有交点

<img src="F:\计算机图形学\fig2\126.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig2\127.png" style="zoom: 50%;" />

这样做若干次光线与格子的求交就可以避免光线与场景中所有物体求交点，需要光栅化这条直线

所采用的格子不能太稀疏，也不能太密集

问题： 如果场景分布不均匀，则不适合用格子解决问题，那么怎么办呢？

**空间划分：**

**KD-Tree：**交替做水平和竖直的划分，在三维下，分别对x，y，z做交替的划分成两个区域，保持了二叉树的性质，KD Tree的建立是在光线追踪之前，先建立好这个结构。

**八叉树：**对x，y，z进行划分，在三维空间中划分成8个区域，再不断的对子结点划分，当区域为空或足够少数量的物体则停止划分

<img src="F:\计算机图形学\fig2\128.png" style="zoom: 33%;" />

BSP-Tree：（二分的方法划分）划分的方向与KDtree相比不是水平的，不好计算，高维度不好处理

<img src="F:\计算机图形学\fig2\129.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig2\130.png" style="zoom:33%;" />

**KD-Trees的数据结构：**

1.知道当前结点按着哪个轴去划分  

2.按着轴划分的位置（中间或其他位置） 

3.中间结点有两个子结点

4.实际的物体，三角形不存在中间节点上，只存储在叶子结点上

<img src="F:\计算机图形学\fig2\131.png" style="zoom:33%;" />

判断相交的过程：光线投射到包围盒，判断与包围盒A是否有交点，有交点，再判断与 1 子节点是否有交点，有交点，再与1中的三角形判断光线与1中三角形是否相交.......

若光线不经过其中的一个子节点（小的包围盒），就不需要判断光线与其中的物体是否相交，因为光线与包围盒没有交点，一定与其中的物体也无交点.

**KDTree缺点**：

1.（结点）小的包围盒与物体（三角形）不容易判断相交或是否包含在包围盒里 ，如果按三角形的顶点判断三角形是否在包围盒内容易判断，但如果包围盒比三角形小很多，包围盒可以做到与三角形任何顶点都不相交但仍与三角形相交

2.同一个物体可能处在多个包围盒（结点）内，需要存储多次

<img src="F:\计算机图形学\fig2\132.png" style="zoom: 67%;" />

BVH加速结构： 通过物体划分

BVH解决了KD-Trees问题，一个物体只可能出现在一个格子里，将物体分成两堆，再对所有三角形求一个包围盒，省去了三角形与包围盒求交的步骤。解决了一个几何结构可能出现在多个叶子节点里的问题.

<img src="F:\计算机图形学\fig2\133.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\134.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\135.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\136.png" style="zoom:50%;" />

### 辐射度量学

辐射度量学将光源，材质，光线的传播方法精确的定义出来.

<img src="F:\计算机图形学\fig2\137.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig2\138.png" style="zoom: 67%;" />

**辐射通量:**

<img src="F:\计算机图形学\fig2\139.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\1.jpg" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\2.png" style="zoom: 80%;" />

<img src="F:\计算机图形学\fig3\3.png" style="zoom: 33%;" />

辐射强度 = W/立体角

<img src="F:\计算机图形学\fig3\4.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\5.png" style="zoom: 33%;" />

整个球面立体角：4ΠR方 / R方

<img src="F:\计算机图形学\fig3\7.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\8.png" style="zoom:33%;" />

<img src="F:\计算机图形学\fig3\9.png" style="zoom:33%;" />

<img src="F:\计算机图形学\fig3\10.png" style="zoom:67%;" />

**辐射照度：**

<img src="F:\计算机图形学\fig3\11.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\13.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig3\14.png" style="zoom: 50%;" />

**辐射亮度：**

向一个方向的辐射亮度与这个光源的面的大小A有关，又与这个面的方向w有关

<img src="F:\计算机图形学\fig3\15.png" style="zoom: 67%;" />

微分两次.

<img src="F:\计算机图形学\fig3\16.png" style="zoom: 33%;" />



<img src="F:\计算机图形学\fig3\17.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig3\18.png" style="zoom:50%;" />

**BRDF:双向反射分布函数**

理解反射：光线打到物体上被吸收，再将吸收来的光反射出去

<img src="F:\计算机图形学\fig3\19.png" style="zoom:50%;" />

**反射方程：**

<img src="F:\计算机图形学\fig3\20.png" style="zoom: 50%;" />

（每一个入射方向都对应一个入射方向初始方向着色点的BRDF）从任意方向来的能量（对于出射方向的贡献都加起来）（irradiance）（在所有可能的入射方向上）经过BRDF反射到出射方向上去，看上去是什么样。

**渲染方程：**

<img src="F:\计算机图形学\fig3\21.png" style="zoom:50%;" />

单个点光源的反射方程：

<img src="F:\计算机图形学\fig3\22.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\23.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\24.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\25.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\26.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\28.png" style="zoom: 33%;" />

**全局光照**就是将所有光线弹射次数的项全部加起来：

<img src="F:\计算机图形学\fig3\27.png" style="zoom:50%;" />

 **简单概率论：**

<img src="F:\计算机图形学\fig3\29.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig3\31.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\32.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig3\33.png" style="zoom: 67%;" />

<img src="F:\计算机图形学\fig3\34.png" style="zoom: 67%;" />

#### 蒙特卡洛积分：

<img src="F:\计算机图形学\fig3\35.png" style="zoom: 33%;" />

蒙特卡洛积分：
在积分域ab内多次采样x，x对应的f（x）即高度，a到为长度b，求出多次采样的长方形的面积之和求平均.

<img src="F:\计算机图形学\fig3\36.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\37.png" style="zoom:50%;" />

**注：蒙特卡洛积分不必关心积分域是多少，积分域已经在PDF（概率密度函数）里体现了。类比 1/（a-b）的概率密度函数（概率密度为常数1/（a-b），积分域为a-b）**

<img src="F:\计算机图形学\fig3\38.png" style="zoom:50%;" />

#### 路径追踪

![](F:\计算机图形学\fig3\142.png)

<img src="F:\计算机图形学\fig3\39.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\40.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\41.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\42.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\43.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\44.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\45.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\46.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\47.png" style="zoom: 50%;" />

**之前计算的是从光源辐射过来的radiance，那么从反射面反射过来的radiance如果处理？**   

从Q点到P着色点，反射过来的radiance等于Q点受到来自光源的直接光照

<img src="F:\计算机图形学\fig3\48.png" style="zoom: 33%;" />

给p着色，从p点向四面八方采样，打到光源，randiance是Li，打到物体randiance就是物体收到的直接光照

**但上述递归方法是不对的，因为每次递归都经过n次采样，弹射多次，次数就是n的指数次幂，导致内存爆炸**

<img src="F:\计算机图形学\fig3\49.png" style="zoom: 33%;" />

如何解决这个问题，随机向一个方向去采样，只打出一根光线，令N=1

<img src="F:\计算机图形学\fig3\50.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\51.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\52.png" style="zoom: 33%;" />

**俄罗斯轮盘赌：**

<img src="F:\计算机图形学\fig3\54.png" style="zoom:33%;" />

正确的算法代码：

**需要利用俄罗斯轮盘赌设置一个递归的终止条件**

<img src="F:\计算机图形学\fig3\55.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\56.png" style="zoom: 33%;" />

**对光源采样：**

<img src="F:\计算机图形学\fig3\57.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\58.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\59.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\60.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\61.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\62.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\63.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\64.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig3\65.png" style="zoom:50%;" />

### 计算机图形学中的材质

![](F:\计算机图形学\fig3\66.png)

#### 漫反射材质

<img src="F:\计算机图形学\fig3\67.png" style="zoom: 67%;" />

**漫反射材质**，在不同的点上有不同的漫反射系数

*下图*：我们假设入射的光任意一个方向上都是uniform均一的，入射与出射的光是能量守恒的irradiance相同，并且物体本身不吸收光：

<img src="F:\计算机图形学\fig3\70.png" style="zoom: 50%;" />

#### Glossy material （BRDF）

<img src="F:\计算机图形学\fig3\71.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\72.png" style="zoom:50%;" />

**反射公式两种不同的理解方式：**

<img src="F:\计算机图形学\fig3\73.png" style="zoom: 50%;" />

#### 折射：

##### 斯涅耳定律

<img src="F:\计算机图形学\fig3\74.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\78.png" style="zoom: 67%;" />



**BRDF 与 BTDF（折射的分布）统称为BSDF**

<img src="F:\计算机图形学\fig3\75.png" style="zoom: 67%;" />

全反射是很容易发生的，人在水里只能看到一个很小的锥形区域

比如说从水底打出的光大于一定的度数所有的光线都会被反射到水底

光线追踪trace一个球的时候，由于球有很好的对称性质，折射进去的光一定会很好的折射出去，在内部不会发生全反射.

##### 菲涅尔项：

光打到物体表面，有多少能量发生了反射，有多少能量发生了折射

<img src="F:\计算机图形学\fig3\76.png" style="zoom: 33%;" />

光的入射角度与法线越垂直，光发生反射的部分的能量越大，光的入射角度与法线越小，光发生折射的部分能量越大.

**导体的菲涅尔项：**在与法线角度成任意的角度，反射率都很高

<img src="F:\计算机图形学\fig3\79.png" style="zoom: 33%;" />

在与法线夹角为0度的时候，R0为基准的反射率，在夹角为90度的时候，反射率为1

<img src="F:\计算机图形学\fig3\80.png" style="zoom: 50%;" />

#### 微表面模型

基于物体的材质，微表面模型

<img src="F:\计算机图形学\fig3\81.png" style="zoom: 33%;" />

从远处看，微表面模型是一个粗糙的平面（材质），从近处看微表面模型是一各个凹凸不同的表面组成的，每个表面微元是镜面反射的物体（几何）.

每个微小的镜面都有自己的朝向，每个微表面都有自己的法线。

<img src="F:\计算机图形学\fig3\82.png" style="zoom:50%;" />

 **自遮挡项：**微表面之间互相发生遮挡，光线被其他微表面遮挡时发生阴影。 当光线与面水平时，自遮挡项容易发 生.

<img src="F:\计算机图形学\fig3\83.png" style="zoom:50%;" />

只有当半程向量方向沿着宏观的法线方向时，微表面才能把入射光方向反射到出射方向上去

<img src="F:\计算机图形学\fig3\84.png" style="zoom: 67%;" />

从微表面的方向性可以看出是各向同性还是各向异性.

<img src="F:\计算机图形学\fig3\85.png" style="zoom: 50%;" />

**各向异性材质的性质 ：** BRDF不满足在相对的方位角上旋转得到同样的BRDF，BRDF不仅与相对方位角有关，还与绝对的方位角有关

<img src="F:\计算机图形学\fig3\86.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig3\87.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig3\88.png" style="zoom: 50%;" />

#### 测量BRDF：

<img src="F:\计算机图形学\fig3\89.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\90.png" style="zoom:50%;" />

### 摄像机，成像方法，透镜

<img src="F:\计算机图形学\fig3\91.png" style="zoom: 33%;" />

**成像方法：** 合成 + 捕捉

**小孔成像：**

<img src="F:\计算机图形学\fig3\92.png" style="zoom:50%;" />

传感器捕捉光线，记录的是irradiance

<img src="F:\计算机图形学\fig3\93.png" style="zoom: 33%;" />

#### 针孔相机成像过程

##### 视场

<img src="F:\计算机图形学\fig3\94.png" style="zoom: 50%;" />

通过减小焦距使得视场增大。

<img src="F:\计算机图形学\fig3\95.png" style="zoom:50%;" />

#### 曝光：

<img src="F:\计算机图形学\fig3\96.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig3\97.png" style="zoom:50%;" />

iso可以线性的提高曝光度，但会发生噪声的问题

<img src="F:\计算机图形学\fig3\98.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\99.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\100.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\101.png" style="zoom:50%;" />

<img src="F:\计算机图形学\fig3\102.png" style="zoom: 33%;" />

#### 薄透镜的近似

<img src="F:\计算机图形学\fig3\104.png" style="zoom:50%;" />

**薄棱镜公式**

<img src="F:\计算机图形学\fig3\105.png" style="zoom: 67%;" />

#### Defocus Blur

<img src="F:\计算机图形学\fig3\107.png" style="zoom: 67%;" />

从Focal Plane处变成一个圆形，C/A这个公式A越大，C就会越大，大光圈就会发生模糊的效果，这种效果就是景深。

Coc的大小与棱镜的大小是成正比的。

<img src="F:\计算机图形学\fig3\108.png" style="zoom: 50%;" />

<img src="F:\计算机图形学\fig3\109.png" style="zoom: 50%;" />

#### 薄棱镜的光线追踪

![](F:\计算机图形学\fig3\110.png)

<img src="F:\计算机图形学\fig3\112.png" style="zoom: 50%;" />

#### 景深：

<img src="F:\计算机图形学\fig3\113.png" style="zoom:33%;" />

在实际的场景内有一段深度，这段深度经过透镜后再成像平面附近形成一段区域，这段区域内Coc都是足够小的。在COC的大小与成像平面的像素比相同或略小，都认为得到的结果都是锐利的

<img src="F:\计算机图形学\fig3\114.png" style="zoom: 67%;" />

景深对应的是COC小的那一段.

<img src="F:\计算机图形学\fig3\115.png" style="zoom: 33%;" />

<img src="F:\计算机图形学\fig3\116.png" style="zoom:50%;" />

